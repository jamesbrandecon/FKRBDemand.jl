<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · FKRBDemand.jl</title><meta name="title" content="Home · FKRBDemand.jl"/><meta property="og:title" content="Home · FKRBDemand.jl"/><meta property="twitter:title" content="Home · FKRBDemand.jl"/><meta name="description" content="Documentation for FKRBDemand.jl."/><meta property="og:description" content="Documentation for FKRBDemand.jl."/><meta property="twitter:description" content="Documentation for FKRBDemand.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>FKRBDemand.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Usage"><span>Usage</span></a></li><li><a class="tocitem" href="#Price-endogeneity"><span>Price endogeneity</span></a></li><li><a class="tocitem" href="#Inference"><span>Inference</span></a></li><li><a class="tocitem" href="#Visualization"><span>Visualization</span></a></li></ul></li><li><a class="tocitem" href="api/">API</a></li><li><a class="tocitem" href="examples/">Examples</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/jamesbrandecon/FKRBDemand.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/jamesbrandecon/FKRBDemand.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="FKRBDemand.jl"><a class="docs-heading-anchor" href="#FKRBDemand.jl">FKRBDemand.jl</a><a id="FKRBDemand.jl-1"></a><a class="docs-heading-anchor-permalink" href="#FKRBDemand.jl" title="Permalink"></a></h1><p><a href="https://jamesbrand.github.io/FKRBDemand.jl/"><img src="https://img.shields.io/badge/docs-latest-blue" alt="Documentation"/></a></p><p>This package implements a simple version of the method introduced by <a href="https://onlinelibrary.wiley.com/doi/abs/10.3982/QE49">Fox, Kim, Ryan, and Bajari (2009)</a> (FKRB) for estimating random coefficient mixed logit demand models with market-level data. This approach allows us to estimate the distribution of consumer preferences nonparametrically and through a simple elastic net regression, thereby avoiding some of the convergence and speed issues with empirical estimation of random coefficient models. The package allows you to do the following with just a few lines of code: </p><ul><li>Estimate a random coefficient logit model </li><li>Run a bootstrap to get standard errors on the resulting model estimates (i.e., estimated weights) </li><li>Calculate price elasticities at existing prices (easy todo: allow for counterfactual prices)</li><li>Plot the (nonparametric) distribution of random coefficients</li></ul><p>Currently, I&#39;ve only implemented the FKRB approach for market-level data. My goal is to have an API which is familiar and relatively consistent across <a href="github.com/jamesbrandecon/FRACDemand.jl">FRACDemand.jl</a>, <a href="github.com/jamesbrandecon/NPDemand.jl">NPDemand.jl</a>, and any other code I share for demand estimation, so that multiple packages can be tested quickly and eventually the packages can be merged together. PRs welcome – without them, updates will be very slow.  </p><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><pre><code class="language-julia hljs">using Pkg; 
# FRAC has to be installed first
Pkg.add(&quot;FRACDemand&quot;) 
# Install FKRBDemand from Github: 
Pkg.add(url = &quot;https://github.com/jamesbrandecon/FKRBDemand.jl&quot;)</code></pre><h2 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h2><pre><code class="language-julia hljs">using FKRBDemand

df = ... # DataFrame with columns:
# &quot;x&quot; (any number of product characteristics),
# &quot;prices&quot;,
# &quot;shares&quot; (market shares),
# &quot;demand_instruments0&quot; (any number of demand instruments)
# &quot;market_ids&quot; 
# &quot;product_ids&quot;</code></pre><p>Estimation is then straightforward: </p><pre><code class="language-julia hljs">problem = FKRBDemand.define_problem( 
        data = df, 
        linear = [&quot;prices&quot;, &quot;x&quot;], # in FKRB, linear and nonlinear should be the same
        nonlinear = [&quot;prices&quot;, &quot;x&quot;], 
        train = [], # the set of market_ids to use for tuning regularization, mostly not yet useful
        fixed_effects = [&quot;product_ids&quot;], # strings of column names in df to aborb in FRAC
        alpha = 0.01, # FKRB grid will aim to cover (1-alpha*100)% of the distribution, based on FRACDemand estimates
        step = 0.1 # step size for the FKRB grid
        );

FKRBDemand.estimate!(problem, 
    method = &quot;elasticnet&quot;, # only useful method implemented so far
    constraints = [:nonnegativity, :proper_weights], # constraints on the weights
    lambda = 1e-6) # regularization strength</code></pre><h2 id="Price-endogeneity"><a class="docs-heading-anchor" href="#Price-endogeneity">Price endogeneity</a><a id="Price-endogeneity-1"></a><a class="docs-heading-anchor-permalink" href="#Price-endogeneity" title="Permalink"></a></h2><p>The <code>FKRB</code> approach is best justified when all product characteristics are exogenous, but we are often interested in settings where that is not the case. The most general approach I&#39;ve seen to handle endogeneity within this estimation approach is that from Meeker (2021), so I implemented a slightly modified version of his approach. I first estimate the model using <code>FRACDemand.jl</code>, using the same problem specifications that have been provided to <code>FKRBDemand.jl</code>, meaning that the regression FRACDemand.jl uses allows for random coefficients and instrument for prices. Then, I store the estimated demand shocks from that procedure and include them in the market-level demand function when estimating through <code>FKRBDemand.jl</code>. The intuition for this approach is that, by generating a good first estimate of unobserved demand shocks, we can then control for those shocks in the second stage. If we think of the regression errors in the FKRB second stage as measurement error, then this approach avoids the omitted variable bias (endogeneity) induced by running <code>FKRBDemand.jl</code> naively without correcting for endogenous prices. </p><p>If you have an alternative preferred approach to estimating demand shocks, simply include a &quot;xi&quot; field in the data you provide to <code>define_problem</code> and these will be included in the utility function automatically. If you need fixed effects too, estimate them first via FRAC or a logit specification, add them together with your residuals <code>xi</code>, and include the sum as the field &quot;xi&quot; in <code>problem.data</code>.</p><h2 id="Inference"><a class="docs-heading-anchor" href="#Inference">Inference</a><a id="Inference-1"></a><a class="docs-heading-anchor-permalink" href="#Inference" title="Permalink"></a></h2><p>I wasn&#39;t sure how to do inference here, but <a href="https://www.imeeker.com/files/jmp.pdf">Meeker (2021)</a> recommends subsampling/bootstrapping. I&#39;ve implemented two simple helper functions for this purpose: <code>bootstrap!</code> and <code>subsample!</code>, which implement the inference approaches corresponding to the function names. Both functions take the <code>FKRBProblem</code> as the sole required argument, plus keyword arguments controlling how many times to repeat the estimation procedure and how large a subsample to use. After one of these functions are called, <code>problem.std</code> will contain the implied standard errors from the called approach. How to make the resulting standard errors easy to use is a work in progress, but <code>problem.results[&quot;boot_weights&quot;]</code> will contain the bootstrapped weights, which can be used to calculate confidence intervals on objects of interest.</p><h2 id="Visualization"><a class="docs-heading-anchor" href="#Visualization">Visualization</a><a id="Visualization-1"></a><a class="docs-heading-anchor-permalink" href="#Visualization" title="Permalink"></a></h2><p>The best function for visualization is now <code>plot_coefficients</code>, which plots a grid of distributions. The diagonal of this grid shows kernel density estimates of the corresponding coefficients, while the off-diagonal elements show the estimated covariance between the coefficients. The function <code>plot_coefficients</code> takes a <code>FKRBProblem</code> object as its only required argument, though the heatmaps, densities, and the set of coefficients to plot can all be controlled through keyword arguments as shown below.</p><pre><code class="language-julia hljs">    plot_coefficients(
        problem;
        select_dims = [&quot;prices&quot;, &quot;x&quot;],
        heatmap_kwargs   = (c = cgrad([:white, :lightblue, :blue]), alpha = 0.6),
        marg_kwargs      = (c = :lightcoral, lw=2, alpha = 0.8, nbins=50)
    )</code></pre></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.11.4 on <span class="colophon-date" title="Saturday 24 May 2025 02:58">Saturday 24 May 2025</span>. Using Julia version 1.10.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
